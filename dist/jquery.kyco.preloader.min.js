/*
**
**  jquery.kyco.preloader
**  =====================
**
**  Version 1.2.3
**
**  Brought to you by
**  https://kyco.io
**
*/

(function(d){var y={preloadSelector:!0,truePercentage:!0,disableOverlay:!1,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:1E3,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},k={init:function(f){var a=d.extend({},y,f);return this.each(function(){function f(){a.debugMode&&(console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": preloading image elements..."),console.groupCollapsed("intervals"));a.forceSequentialLoad?function e(a){var c=m[a],g=d("<img>").attr("src",z(c.node));g.on("load",function(){u(c);++a<m.length&&e(a)});g.on("error",function(){u(c);++a<m.length&&e(a);E(g,c)})}(0):m.forEach(function(a,e){var c=d("<img>").attr("src",z(a.node));c.on("load",function(){u(a)});c.on("error",function(){u(a);E(c,a)})})}function E(a,c){c.node.addClass("kyco_preloader_not_found_error")}function u(b){v++;a.truePercentage?(n+=b.fileSize/p*100,v===q&&(n=100)):n=v/p*100;k(n,void 0,b);a.progressiveReveal&&r(b.node);a.afterEach.call(b.node)}function k(b,c,e){c=void 0!==c?c:a.animateDuration;var d=0,g=b;void 0===c&&a.debugMode&&console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": "+b.toFixed(2)+"%");100>b&&void 0!==e&&(void 0===e.round?(e.round=0,g=b/4*3):(e.round++,g=b/(4+e.round)*(3+e.round),c=200));void 0===e&&(e={});void 0===e.round&&(e.round=0);g>w&&(w=g);g<w&&(g=w);x.stop();30>e.round&&x.animate({width:g+"%"},{duration:c,easing:"linear",step:function(){d=A.width();B.children("span").html(Math.round(x.width()/d*100))},complete:function(){B.children("span").html(Math.round(g));v===q?(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": preloading image elements DONE"),console.groupEnd()),x.delay(100).queue(function(){a.showImagesBeforeComplete?(m.forEach(function(a){r(a.node)}),C.forEach(function(a){r(a)}),a.beforeComplete.call(this),h.animate({opacity:"0"},a.fadeOutDuration,function(){h.remove();a.onComplete.call(this)})):(a.beforeComplete.call(this),h.animate({opacity:"0"},a.fadeOutDuration,function(){m.forEach(function(a){r(a.node)});C.forEach(function(a){r(a)});h.remove();a.onComplete.call(this)}))})):k(b,c,e)}})}function z(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function r(b){a.useOpacity?b.css("opacity","1"):b.show();b.attr("data-bg")&&b.css("background-image",b.attr("data-bg"))}var t=d(this),y=function(b){function c(a){a=a.children();0<a.length&&a.each(function(){var a=d(this);e.push(a);0<a.children().length&&c(a)})}var e=[];0<b.children().length?(a.preloadSelector&&e.push(b),c(b)):a.preloadSelector&&e.push(b);return e}(t),m=[],C=[],v=0,q=0,n=0,p=0,F=0,w=0,h=d('<div id="kyco_preloader"></div>');a.showInContainer?(h.appendTo(t),t.css("position","relative"),h.css("position","absolute")):(h.appendTo("body"),h.css("position","fixed"));a.disableOverlay?h.css("height","auto"):d('<div class="kyco_loader_overlay"></div>').appendTo(h);var D=d('<div class="kyco_loader"></div>').appendTo(h),B=a.hidePercentage?d('<div class="kyco_progress_notification">'+a.loaderText+"</div>").appendTo(D):d('<div class="kyco_progress_notification">'+a.loaderText+' <span class="kyco_progress_percentage">'+n+"</span>%</div>").appendTo(D),A=d('<div class="kyco_progress_bar"></div>').appendTo(D),x=d('<div class="kyco_progress_loaded"></div>').appendTo(A);a.silentMode&&h.hide();a.truePercentage&&k(1,3E3);if(a.debugMode){var l=(new Date).getTime();console.groupCollapsed("kycoPreload > ",t);console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": scanning DOM for image elements...");console.groupCollapsed("image elements")}y.forEach(function(b){b.is("img")||"none"!==b.css("background-image")&&-1==b.css("background-image").indexOf("gradient")?(a.preloadSelector&&a.showInContainer&&b===t?a.hideBackground&&b.attr("data-bg",b.css("background-image")).css("background-image","none"):a.useOpacity?b.css("opacity","0"):b.hide(),b={node:b,fileSize:0},a.debugMode&&console.log(b.node),m.push(b),q++):a.hideNonImageElements&&(a.useOpacity?b.css("opacity","0"):b.hide(),C.push(b))});a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": scanning DOM for image elements DONE"));a.truePercentage?(a.debugMode&&(console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": getting image sizes..."),console.groupCollapsed("image sizes")),m.forEach(function(b){function c(){F++;F===q&&(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": getting image sizes DONE")),f())}d.ajax({type:"HEAD",cache:!1,url:z(b.node),success:function(e,d,g){b.fileSize=parseInt(g.getResponseHeader("Content-Length"));p+=b.fileSize;a.debugMode&&console.log((b.fileSize/1E3).toFixed(2)+" KB \t"+(p/1E3).toFixed(2)+" KB total");c()},error:function(b,f,g){c();B.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exist.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a remote domain set <code>truePercentage: false</code>.<br><br><button>Close</button>");A.addClass("error");a.fadeOutDuration=5E5;d("#kyco_preloader button").click(function(){h.remove()})}})})):(a.debugMode&&console.log((((new Date).getTime()-l)/1E3).toFixed(3)+": getting image sizes SKIPPED"),p=q,f())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(d,a){for(var f=0,k=this.length;f<k;f++)f in this&&d.call(a,this[f],f,this)});d.fn.kycoPreload=function(f){if(k[f])return k[f].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof f&&f)d.error("Method "+f+" does not exist on jQuery.kycoPreload");else return k.init.apply(this,arguments)}})(jQuery);
