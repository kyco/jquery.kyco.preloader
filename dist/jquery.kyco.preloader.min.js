/*
**
**  jquery.kyco.preloader
**  =====================
**
**  Version 1.2.2
**
**  Brought to you by
**  https://kyco.io
**
*/

(function(c){var z={preloadSelector:!0,truePercentage:!0,disableOverlay:!1,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:1E3,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},h={init:function(k){var a=c.extend({},z,k);return this.each(function(){function k(){a.debugMode&& (console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": preloading image elements..."),console.groupCollapsed("intervals"));a.forceSequentialLoad?function e(a){var l=n[a],f=c("<img>").attr("src",A(l.node));f.load(function(){u(l);++a<n.length&&e(a)}).error(function(){u(l);++a<n.length&&e(a);v(f,l)})}(0):n.forEach(function(a,d){var l=c("<img>").attr("src",A(a.node));l.load(function(){u(a)}).error(function(){u(a);v(l,a)})})}function v(a,e){e.node.addClass("kyco_preloader_not_found_error")}function u(b){w++; a.truePercentage?(p+=b.fileSize/q*100,w===r&&(p=100)):p=w/q*100;h(p,void 0,b);a.progressiveReveal&&s(b.node);a.afterEach.call(b.node)}function h(b,e,d){e=void 0!==e?e:a.animateDuration;var l=0,f=b;void 0===e&&a.debugMode&&console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": "+b.toFixed(2)+"%");100>b&&void 0!==d&&(void 0===d.round?(d.round=0,f=b/4*3):(d.round++,f=b/(4+d.round)*(3+d.round),e=200));void 0===d&&(d={});void 0===d.round&&(d.round=0);f>x&&(x=f);f<x&&(f=x);y.stop();30>d.round&&y.animate({width:f+ "%"},{duration:e,easing:"linear",step:function(){l=B.width();C.children("span").html(Math.round(y.width()/l*100))},complete:function(){C.children("span").html(Math.round(f));w===r?(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": preloading image elements DONE"),console.groupEnd()),y.delay(100).queue(function(){a.showImagesBeforeComplete?(n.forEach(function(a){s(a.node)}),D.forEach(function(a){s(a)}),a.beforeComplete.call(this),g.animate({opacity:"0"},a.fadeOutDuration, function(){g.remove();a.onComplete.call(this)})):(a.beforeComplete.call(this),g.animate({opacity:"0"},a.fadeOutDuration,function(){n.forEach(function(a){s(a.node)});D.forEach(function(a){s(a)});g.remove();a.onComplete.call(this)}))})):h(b,e,d)}})}function A(a){return"none"!==a.css("background-image")?a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")} function s(b){a.useOpacity?b.css("opacity","1"):b.show();b.attr("data-bg")&&b.css("background-image",b.attr("data-bg"))}var t=c(this),z=function(b){function e(a){a=a.children();0<a.length&&a.each(function(){var a=c(this);d.push(a);0<a.children().length&&e(a)})}var d=[];0<b.children().length?(a.preloadSelector&&d.push(b),e(b)):a.preloadSelector&&d.push(b);return d}(t),n=[],D=[],w=0,r=0,p=0,q=0,F=0,x=0,g=c('<div id="kyco_preloader"></div>');a.showInContainer?(g.appendTo(t),t.css("position","relative"), g.css("position","absolute")):(g.appendTo("body"),g.css("position","fixed"));a.disableOverlay?g.css("height","auto"):c('<div class="kyco_loader_overlay"></div>').appendTo(g);var E=c('<div class="kyco_loader"></div>').appendTo(g),C=a.hidePercentage?c('<div class="kyco_progress_notification">'+a.loaderText+"</div>").appendTo(E):c('<div class="kyco_progress_notification">'+a.loaderText+' <span class="kyco_progress_percentage">'+p+"</span>%</div>").appendTo(E),B=c('<div class="kyco_progress_bar"></div>').appendTo(E), y=c('<div class="kyco_progress_loaded"></div>').appendTo(B);a.silentMode&&g.hide();a.truePercentage&&h(1,3E3);if(a.debugMode){var m=(new Date).getTime();console.groupCollapsed("kycoPreload > ",t);console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": scanning DOM for image elements...");console.groupCollapsed("image elements")}z.forEach(function(b){b.is("img")||"none"!==b.css("background-image")&&-1==b.css("background-image").indexOf("gradient")?(a.preloadSelector&&a.showInContainer&&b===t?a.hideBackground&& b.attr("data-bg",b.css("background-image")).css("background-image","none"):a.useOpacity?b.css("opacity","0"):b.hide(),b={node:b,fileSize:0},a.debugMode&&console.log(b.node),n.push(b),r++):a.hideNonImageElements&&(a.useOpacity?b.css("opacity","0"):b.hide(),D.push(b))});a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": scanning DOM for image elements DONE"));a.truePercentage?(a.debugMode&&(console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": getting image sizes..."), console.groupCollapsed("image sizes")),n.forEach(function(b){function e(){F++;F===r&&(a.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": getting image sizes DONE")),k())}c.ajax({type:"HEAD",cache:!1,url:A(b.node),success:function(d,c,f){b.fileSize=parseInt(f.getResponseHeader("Content-Length"));q+=b.fileSize;a.debugMode&&console.log((b.fileSize/1E3).toFixed(2)+" KB \t"+(q/1E3).toFixed(2)+" KB total");e()},error:function(b,k,f){e();b="Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>"; b+="1. Make sure your images exist.<br>";b+="2. Make sure your image paths/urls are correct.<br>";b+="3. If you load images from a remote domain set <code>truePercentage: false</code>.<br><br>";b+="<button>Close</button>";C.addClass("error").html(b);B.addClass("error");a.fadeOutDuration=5E5;c("#kyco_preloader button").click(function(){g.remove()})}})})):(a.debugMode&&console.log((((new Date).getTime()-m)/1E3).toFixed(3)+": getting image sizes SKIPPED"),q=r,k())})}};"forEach"in Array.prototype||(Array.prototype.forEach= function(c,a){for(var h=0,v=this.length;h<v;h++)h in this&&c.call(a,this[h],h,this)});c.fn.kycoPreload=function(k){if(h[k])return h[k].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof k&&k)c.error("Method "+k+" does not exist on jQuery.kycoPreload");else return h.init.apply(this,arguments)}})(jQuery);
